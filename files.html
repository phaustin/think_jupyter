

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Files &#8212; How to think like a computer scientist</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/jupyter-sphinx.css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/sphinx-book-theme.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/mystnb.js"></script>
    <script src="_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .secondtoggle, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Classes and objects" href="classes_I.html" />
    <link rel="prev" title="Case study: data structure selection" href="case_study_data_structures.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  
  <h1 class="site-logo" id="site-title">How to think like a computer scientist</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  
  <ul class="nav sidenav_l1">
  <li class="">
    <a href="preface.html">Preface  – work in progress, cross-references/figures to be added</a>
  </li>
  <li class="">
    <a href="intro.html">Introduction</a>
  </li>
  <li class="">
    <a href="way_of.html">The way of the program</a>
  </li>
  <li class="">
    <a href="variables.html">Variables, expressions and statements</a>
  </li>
  <li class="">
    <a href="functions.html">Functions</a>
  </li>
  <li class="">
    <a href="case_study_interface.html">Case study: interface design</a>
  </li>
  <li class="">
    <a href="conditionals.html">Conditionals and recursion</a>
  </li>
  <li class="">
    <a href="fruitful_functions.html">Fruitful functions</a>
  </li>
  <li class="">
    <a href="iteration.html">Iteration</a>
  </li>
  <li class="">
    <a href="strings.html">Strings</a>
  </li>
  <li class="">
    <a href="case_study_wordplay.html">Case study: word play</a>
  </li>
  <li class="">
    <a href="lists.html">Lists</a>
  </li>
  <li class="">
    <a href="dictionaries.html">Dictionaries</a>
  </li>
  <li class="">
    <a href="tuples.html">Tuples</a>
  </li>
  <li class="">
    <a href="case_study_data_structures.html">Case study: data structure selection</a>
  </li>
  <li class="active">
    <a href="">Files</a>
  </li>
  <li class="">
    <a href="classes_I.html">Classes and objects</a>
  </li>
  <li class="">
    <a href="classes_II.html">Classes and functions</a>
  </li>
  <li class="">
    <a href="classes_III.html">Classes and methods</a>
  </li>
  <li class="">
    <a href="classes_IV.html">Inheritance</a>
  </li>
  <li class="">
    <a href="advanced.html">The Goodies</a>
  </li>
  <li class="">
    <a href="debugging.html">Debugging</a>
  </li>
  <li class="">
    <a href="algorithms.html">Analysis of Algorithms</a>
  </li>
</ul>
</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse" data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu" aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation" title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
            <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i class="fas fa-download"></i></button>

            
            <div class="dropdown-buttons">
                <!-- ipynb file if we had a myst markdown file -->
                
                <!-- Download raw file -->
                <a class="dropdown-buttons" href="_sources/files.md"><button type="button" class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip" data-placement="left">.md</button></a>
                <!-- Download PDF via print -->
                <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF" onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
            </div>
            
        </div>

        <!-- Edit this page -->
        

        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->
        
    </div>
    <div class="d-none d-md-block col-md-2 bd-toc show">
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#persistence" class="nav-link">Persistence</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#reading-and-writing" class="nav-link">Reading and writing</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#format-operator" class="nav-link">Format operator</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#filenames-and-paths" class="nav-link">Filenames and paths</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#catching-exceptions" class="nav-link">Catching exceptions</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#databases" class="nav-link">Databases</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#pickling" class="nav-link">Pickling</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#pipes" class="nav-link">Pipes</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#writing-modules" class="nav-link">Writing modules</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#debugging" class="nav-link">Debugging</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#glossary" class="nav-link">Glossary</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#exercises" class="nav-link">Exercises</a>
        </li>
    
    </ul>
</nav>


    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="files">
<h1>Files<a class="headerlink" href="#files" title="Permalink to this headline">¶</a></h1>
<p>This chapter introduces the idea of “persistent” programs that keep data
in permanent storage, and shows how to use different kinds of permanent
storage, like files and databases.</p>
<div class="section" id="persistence">
<h2>Persistence<a class="headerlink" href="#persistence" title="Permalink to this headline">¶</a></h2>
<p>Most of the programs we have seen so far are transient in the sense that
they run for a short time and produce some output, but when they end,
their data disappears. If you run the program again, it starts with a
clean slate.</p>
<p>Other programs are <span><strong>persistent</strong></span>: they run for a long time
(or all the time); they keep at least some of their data in permanent
storage (a hard drive, for example); and if they shut down and restart,
they pick up where they left off.</p>
<p>Examples of persistent programs are operating systems, which run pretty
much whenever a computer is on, and web servers, which run all the time,
waiting for requests to come in on the network.</p>
<p>One of the simplest ways for programs to maintain their data is by
reading and writing text files. We have already seen programs that read
text files; in this chapter we will see programs that write them.</p>
<p>An alternative is to store the state of the program in a database. In
this chapter I will present a simple database and a module,
<span><code class="docutils literal notranslate"><span class="pre">pickle</span></code></span>, that makes it easy to store program data.</p>
</div>
<div class="section" id="reading-and-writing">
<h2>Reading and writing<a class="headerlink" href="#reading-and-writing" title="Permalink to this headline">¶</a></h2>
<p>A text file is a sequence of characters stored on a permanent medium
like a hard drive, flash memory, or CD-ROM. We saw how to open and read
a file in Section <a class="reference external" href="#wordlist">10.1</a>.</p>
<p>To write a file, you have to open it with mode <code class="docutils literal notranslate"><span class="pre">'w'</span></code> as a second
parameter:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; fout = open(&#39;output.txt&#39;, &#39;w&#39;)
</pre></div>
</div>
<p>If the file already exists, opening it in write mode clears out the old
data and starts fresh, so be careful! If the file doesn’t exist, a new
one is created.</p>
<p><span><code class="docutils literal notranslate"><span class="pre">open</span></code></span> returns a file object that provides methods for
working with the file. The <span><code class="docutils literal notranslate"><span class="pre">write</span></code></span> method puts data into
the file.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; line1 = &quot;This here&#39;s the wattle,\n&quot;
&gt;&gt;&gt; fout.write(line1)
24
</pre></div>
</div>
<p>The return value is the number of characters that were written. The file
object keeps track of where it is, so if you call <span><code class="docutils literal notranslate"><span class="pre">write</span></code></span>
again, it adds the new data to the end of the file.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; line2 = &quot;the emblem of our land.\n&quot;
&gt;&gt;&gt; fout.write(line2)
24
</pre></div>
</div>
<p>When you are done writing, you should close the file.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; fout.close()
</pre></div>
</div>
<p>If you don’t close the file, it gets closed for you when the program
ends.</p>
</div>
<div class="section" id="format-operator">
<h2>Format operator<a class="headerlink" href="#format-operator" title="Permalink to this headline">¶</a></h2>
<p>The argument of <span><code class="docutils literal notranslate"><span class="pre">write</span></code></span> has to be a string, so if we want
to put other values in a file, we have to convert them to strings. The
easiest way to do that is with <span><code class="docutils literal notranslate"><span class="pre">str</span></code></span>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; x = 52
&gt;&gt;&gt; fout.write(str(x))
</pre></div>
</div>
<p>An alternative is to use the <span><strong>format operator</strong></span>,
<span><code class="docutils literal notranslate"><span class="pre">%</span></code></span>. When applied to integers, <span><code class="docutils literal notranslate"><span class="pre">%</span></code></span> is the
modulus operator. But when the first operand is a string,
<span><code class="docutils literal notranslate"><span class="pre">%</span></code></span> is the format operator.</p>
<p>The first operand is the <span><strong>format string</strong></span>, which contains
one or more <span><strong>format sequences</strong></span>, which specify how the
second operand is formatted. The result is a string.</p>
<p>For example, the format sequence <code class="docutils literal notranslate"><span class="pre">'%d'</span></code> means that the second operand
should be formatted as a decimal integer:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; camels = 42
&gt;&gt;&gt; &#39;%d&#39; % camels
&#39;42&#39;
</pre></div>
</div>
<p>The result is the string <code class="docutils literal notranslate"><span class="pre">'42'</span></code>, which is not to be confused with the
integer value <span><code class="docutils literal notranslate"><span class="pre">42</span></code></span>.</p>
<p>A format sequence can appear anywhere in the string, so you can embed a
value in a sentence:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; &#39;I have spotted %d camels.&#39; % camels
&#39;I have spotted 42 camels.&#39;
</pre></div>
</div>
<p>If there is more than one format sequence in the string, the second
argument has to be a tuple. Each format sequence is matched with an
element of the tuple, in order.</p>
<p>The following example uses <code class="docutils literal notranslate"><span class="pre">'%d'</span></code> to format an integer, <code class="docutils literal notranslate"><span class="pre">'%g'</span></code> to format
a floating-point number, and <code class="docutils literal notranslate"><span class="pre">'%s'</span></code> to format a string:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; &#39;In %d years I have spotted %g %s.&#39; % (3, 0.1, &#39;camels&#39;)
&#39;In 3 years I have spotted 0.1 camels.&#39;
</pre></div>
</div>
<p>The number of elements in the tuple has to match the number of format
sequences in the string. Also, the types of the elements have to match
the format sequences:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; &#39;%d %d %d&#39; % (1, 2)
TypeError: not enough arguments for format string
&gt;&gt;&gt; &#39;%d&#39; % &#39;dollars&#39;
TypeError: %d format: a number is required, not str
</pre></div>
</div>
<p>In the first example, there aren’t enough elements; in the second, the
element is the wrong type.</p>
<p>For more information on the format operator, see
<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#printf-style-string-formatting">https://docs.python.org/3/library/stdtypes.html#printf-style-string-formatting</a>.
A more powerful alternative is the string format method, which you can
read about at
<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str.format">https://docs.python.org/3/library/stdtypes.html#str.format</a>.</p>
</div>
<div class="section" id="filenames-and-paths">
<h2>Filenames and paths<a class="headerlink" href="#filenames-and-paths" title="Permalink to this headline">¶</a></h2>
<p>Files are organized into <span><strong>directories</strong></span> (also called
“folders”). Every running program has a “current directory”, which is
the default directory for most operations. For example, when you open a
file for reading, Python looks for it in the current directory.</p>
<p>The <span><code class="docutils literal notranslate"><span class="pre">os</span></code></span> module provides functions for working with files
and directories (“os” stands for “operating system”).
<span><code class="docutils literal notranslate"><span class="pre">os.getcwd</span></code></span> returns the name of the current directory:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; import os
&gt;&gt;&gt; cwd = os.getcwd()
&gt;&gt;&gt; cwd
&#39;/home/dinsdale&#39;
</pre></div>
</div>
<p><span><code class="docutils literal notranslate"><span class="pre">cwd</span></code></span> stands for “current working directory”. The result in
this example is <span><code class="docutils literal notranslate"><span class="pre">/home/dinsdale</span></code></span>, which is the home
directory of a user named <span><code class="docutils literal notranslate"><span class="pre">dinsdale</span></code></span>.</p>
<p>A string like <code class="docutils literal notranslate"><span class="pre">'/home/dinsdale'</span></code> that identifies a file or directory is
called a <span><strong>path</strong></span>.</p>
<p>A simple filename, like <span><code class="docutils literal notranslate"><span class="pre">memo.txt</span></code></span> is also considered a
path, but it is a <span><strong>relative path</strong></span> because it relates to
the current directory. If the current directory is
<span><code class="docutils literal notranslate"><span class="pre">/home/dinsdale</span></code></span>, the filename <span><code class="docutils literal notranslate"><span class="pre">memo.txt</span></code></span>
would refer to <span><code class="docutils literal notranslate"><span class="pre">/home/dinsdale/memo.txt</span></code></span>.</p>
<p>A path that begins with <span><code class="docutils literal notranslate"><span class="pre">/</span></code></span> does not depend on the current
directory; it is called an <span><strong>absolute path</strong></span>. To find the
absolute path to a file, you can use <span><code class="docutils literal notranslate"><span class="pre">os.path.abspath</span></code></span>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; os.path.abspath(&#39;memo.txt&#39;)
&#39;/home/dinsdale/memo.txt&#39;
</pre></div>
</div>
<p><span><code class="docutils literal notranslate"><span class="pre">os.path</span></code></span> provides other functions for working with
filenames and paths. For example, <span><code class="docutils literal notranslate"><span class="pre">os.path.exists</span></code></span> checks
whether a file or directory exists:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; os.path.exists(&#39;memo.txt&#39;)
True
</pre></div>
</div>
<p>If it exists, <span><code class="docutils literal notranslate"><span class="pre">os.path.isdir</span></code></span> checks whether it’s a
directory:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; os.path.isdir(&#39;memo.txt&#39;)
False
&gt;&gt;&gt; os.path.isdir(&#39;/home/dinsdale&#39;)
True
</pre></div>
</div>
<p>Similarly, <span><code class="docutils literal notranslate"><span class="pre">os.path.isfile</span></code></span> checks whether it’s a file.</p>
<p><span><code class="docutils literal notranslate"><span class="pre">os.listdir</span></code></span> returns a list of the files (and other
directories) in the given directory:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; os.listdir(cwd)
[&#39;music&#39;, &#39;photos&#39;, &#39;memo.txt&#39;]
</pre></div>
</div>
<p>To demonstrate these functions, the following example “walks” through a
directory, prints the names of all the files, and calls itself
recursively on all the directories.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>def walk(dirname):
    for name in os.listdir(dirname):
        path = os.path.join(dirname, name)

        if os.path.isfile(path):
            print(path)
        else:
            walk(path)
</pre></div>
</div>
<p><span><code class="docutils literal notranslate"><span class="pre">os.path.join</span></code></span> takes a directory and a file name and joins
them into a complete path.</p>
<p>The <span><code class="docutils literal notranslate"><span class="pre">os</span></code></span> module provides a function called
<span><code class="docutils literal notranslate"><span class="pre">walk</span></code></span> that is similar to this one but more versatile. As
an exercise, read the documentation and use it to print the names of the
files in a given directory and its subdirectories. You can download my
solution from <a class="reference external" href="http://thinkpython2.com/code/walk.py">http://thinkpython2.com/code/walk.py</a>.</p>
</div>
<div class="section" id="catching-exceptions">
<h2>Catching exceptions<a class="headerlink" href="#catching-exceptions" title="Permalink to this headline">¶</a></h2>
<p>A lot of things can go wrong when you try to read and write files. If
you try to open a file that doesn’t exist, you get an
<span><code class="docutils literal notranslate"><span class="pre">IOError</span></code></span>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; fin = open(&#39;bad_file&#39;)
IOError: [Errno 2] No such file or directory: &#39;bad_file&#39;
</pre></div>
</div>
<p>If you don’t have permission to access a file:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; fout = open(&#39;/etc/passwd&#39;, &#39;w&#39;)
PermissionError: [Errno 13] Permission denied: &#39;/etc/passwd&#39;
</pre></div>
</div>
<p>And if you try to open a directory for reading, you get</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; fin = open(&#39;/home&#39;)
IsADirectoryError: [Errno 21] Is a directory: &#39;/home&#39;
</pre></div>
</div>
<p>To avoid these errors, you could use functions like
<span><code class="docutils literal notranslate"><span class="pre">os.path.exists</span></code></span> and <span><code class="docutils literal notranslate"><span class="pre">os.path.isfile</span></code></span>, but it
would take a lot of time and code to check all the possibilities (if
“<span><code class="docutils literal notranslate"><span class="pre">Errno</span> <span class="pre">21</span></code></span>” is any indication, there are at least 21
things that can go wrong).</p>
<p>It is better to go ahead and try—and deal with problems if they
happen—which is exactly what the <span><code class="docutils literal notranslate"><span class="pre">try</span></code></span> statement does.
The syntax is similar to an <span><code class="docutils literal notranslate"><span class="pre">if...else</span></code></span> statement:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>try:    
    fin = open(&#39;bad_file&#39;)
except:
    print(&#39;Something went wrong.&#39;)
</pre></div>
</div>
<p>Python starts by executing the <span><code class="docutils literal notranslate"><span class="pre">try</span></code></span> clause. If all goes
well, it skips the <span><code class="docutils literal notranslate"><span class="pre">except</span></code></span> clause and proceeds. If an
exception occurs, it jumps out of the <span><code class="docutils literal notranslate"><span class="pre">try</span></code></span> clause and runs
the <span><code class="docutils literal notranslate"><span class="pre">except</span></code></span> clause.</p>
<p>Handling an exception with a <span><code class="docutils literal notranslate"><span class="pre">try</span></code></span> statement is called
<span> <strong>catching</strong></span> an exception. In this example, the
<span><code class="docutils literal notranslate"><span class="pre">except</span></code></span> clause prints an error message that is not very
helpful. In general, catching an exception gives you a chance to fix the
problem, or try again, or at least end the program gracefully.</p>
</div>
<div class="section" id="databases">
<h2>Databases<a class="headerlink" href="#databases" title="Permalink to this headline">¶</a></h2>
<p>A <span><strong>database</strong></span> is a file that is organized for storing
data. Many databases are organized like a dictionary in the sense that
they map from keys to values. The biggest difference between a database
and a dictionary is that the database is on disk (or other permanent
storage), so it persists after the program ends.</p>
<p>The module <span><code class="docutils literal notranslate"><span class="pre">dbm</span></code></span> provides an interface for creating and
updating database files. As an example, I’ll create a database that
contains captions for image files.</p>
<p>Opening a database is similar to opening other files:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; import dbm
&gt;&gt;&gt; db = dbm.open(&#39;captions&#39;, &#39;c&#39;)
</pre></div>
</div>
<p>The mode <code class="docutils literal notranslate"><span class="pre">'c'</span></code> means that the database should be created if it doesn’t
already exist. The result is a database object that can be used (for
most operations) like a dictionary.</p>
<p>When you create a new item, <span><code class="docutils literal notranslate"><span class="pre">dbm</span></code></span> updates the database
file.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; db[&#39;cleese.png&#39;] = &#39;Photo of John Cleese.&#39;
</pre></div>
</div>
<p>When you access one of the items, <span><code class="docutils literal notranslate"><span class="pre">dbm</span></code></span> reads the file:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; db[&#39;cleese.png&#39;]
b&#39;Photo of John Cleese.&#39;
</pre></div>
</div>
<p>The result is a <span><strong>bytes object</strong></span>, which is why it begins
with <span><code class="docutils literal notranslate"> <span class="pre">b</span></code></span>. A bytes object is similar to a string in many
ways. When you get farther into Python, the difference becomes
important, but for now we can ignore it.</p>
<p>If you make another assignment to an existing key, <span><code class="docutils literal notranslate"><span class="pre">dbm</span></code></span>
replaces the old value:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; db[&#39;cleese.png&#39;] = &#39;Photo of John Cleese doing a silly walk.&#39;
&gt;&gt;&gt; db[&#39;cleese.png&#39;]
b&#39;Photo of John Cleese doing a silly walk.&#39;
</pre></div>
</div>
<p>Some dictionary methods, like <span><code class="docutils literal notranslate"><span class="pre">keys</span></code></span> and
<span><code class="docutils literal notranslate"><span class="pre">items</span></code></span>, don’t work with database objects. But iteration
with a <span><code class="docutils literal notranslate"><span class="pre">for</span></code></span> loop works:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>for key in db:
    print(key, db[key])
</pre></div>
</div>
<p>As with other files, you should close the database when you are done:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; db.close()
</pre></div>
</div>
</div>
<div class="section" id="pickling">
<h2>Pickling<a class="headerlink" href="#pickling" title="Permalink to this headline">¶</a></h2>
<p>A limitation of <span><code class="docutils literal notranslate"><span class="pre">dbm</span></code></span> is that the keys and values have to
be strings or bytes. If you try to use any other type, you get an error.</p>
<p>The <span><code class="docutils literal notranslate"><span class="pre">pickle</span></code></span> module can help. It translates almost any type
of object into a string suitable for storage in a database, and then
translates strings back into objects.</p>
<p><span><code class="docutils literal notranslate"><span class="pre">pickle.dumps</span></code></span> takes an object as a parameter and returns a
string representation (<span><code class="docutils literal notranslate"><span class="pre">dumps</span></code></span> is short for “dump string”):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; import pickle
&gt;&gt;&gt; t = [1, 2, 3]
&gt;&gt;&gt; pickle.dumps(t)
b&#39;\x80\x03]q\x00(K\x01K\x02K\x03e.&#39;
</pre></div>
</div>
<p>The format isn’t obvious to human readers; it is meant to be easy for
<span><code class="docutils literal notranslate"><span class="pre">pickle</span></code></span> to interpret. <span><code class="docutils literal notranslate"><span class="pre">pickle.loads</span></code></span> (“load
string”) reconstitutes the object:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; t1 = [1, 2, 3]
&gt;&gt;&gt; s = pickle.dumps(t1)
&gt;&gt;&gt; t2 = pickle.loads(s)
&gt;&gt;&gt; t2
[1, 2, 3]
</pre></div>
</div>
<p>Although the new object has the same value as the old, it is not (in
general) the same object:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; t1 == t2
True
&gt;&gt;&gt; t1 is t2
False
</pre></div>
</div>
<p>In other words, pickling and then unpickling has the same effect as
copying the object.</p>
<p>You can use <span><code class="docutils literal notranslate"><span class="pre">pickle</span></code></span> to store non-strings in a database. In
fact, this combination is so common that it has been encapsulated in a
module called <span><code class="docutils literal notranslate"><span class="pre">shelve</span></code></span>.</p>
</div>
<div class="section" id="pipes">
<h2>Pipes<a class="headerlink" href="#pipes" title="Permalink to this headline">¶</a></h2>
<p>Most operating systems provide a command-line interface, also known as a
<span><strong>shell</strong></span>. Shells usually provide commands to navigate the
file system and launch applications. For example, in Unix you can change
directories with <span><code class="docutils literal notranslate"><span class="pre">cd</span></code></span>, display the contents of a directory
with <span><code class="docutils literal notranslate"><span class="pre">ls</span></code></span>, and launch a web browser by typing (for example)
<span><code class="docutils literal notranslate"><span class="pre">firefox</span></code></span>.</p>
<p>Any program that you can launch from the shell can also be launched from
Python using a <span><strong>pipe object</strong></span>, which represents a running
program.</p>
<p>For example, the Unix command <span><code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">-l</span></code></span> normally displays the
contents of the current directory in long format. You can launch
<span><code class="docutils literal notranslate"><span class="pre">ls</span></code></span> with <span><code class="docutils literal notranslate"><span class="pre">os.popen</span></code></span>[1]:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; cmd = &#39;ls -l&#39;
&gt;&gt;&gt; fp = os.popen(cmd)
</pre></div>
</div>
<p>The argument is a string that contains a shell command. The return value
is an object that behaves like an open file. You can read the output
from the <span><code class="docutils literal notranslate"><span class="pre">ls</span></code></span> process one line at a time with
<span><code class="docutils literal notranslate"><span class="pre">readline</span></code></span> or get the whole thing at once with
<span><code class="docutils literal notranslate"><span class="pre">read</span></code></span>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; res = fp.read()
</pre></div>
</div>
<p>When you are done, you close the pipe like a file:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; stat = fp.close()
&gt;&gt;&gt; print(stat)
None
</pre></div>
</div>
<p>The return value is the final status of the <span><code class="docutils literal notranslate"><span class="pre">ls</span></code></span> process;
<span><code class="docutils literal notranslate"><span class="pre">None</span></code></span> means that it ended normally (with no errors).</p>
<p>For example, most Unix systems provide a command called
<span><code class="docutils literal notranslate"><span class="pre">md5sum</span></code></span> that reads the contents of a file and computes a
“checksum”. You can read about MD5 at
<a class="reference external" href="http://en.wikipedia.org/wiki/Md5">http://en.wikipedia.org/wiki/Md5</a>. This command provides an efficient
way to check whether two files have the same contents. The probability
that different contents yield the same checksum is very small (that is,
unlikely to happen before the universe collapses).</p>
<p>You can use a pipe to run <span><code class="docutils literal notranslate"><span class="pre">md5sum</span></code></span> from Python and get the
result:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; filename = &#39;book.tex&#39;
&gt;&gt;&gt; cmd = &#39;md5sum &#39; + filename
&gt;&gt;&gt; fp = os.popen(cmd)
&gt;&gt;&gt; res = fp.read()
&gt;&gt;&gt; stat = fp.close()
&gt;&gt;&gt; print(res)
1e0033f0ed0656636de0d75144ba32e0  book.tex
&gt;&gt;&gt; print(stat)
None
</pre></div>
</div>
</div>
<div class="section" id="writing-modules">
<h2>Writing modules<a class="headerlink" href="#writing-modules" title="Permalink to this headline">¶</a></h2>
<p>Any file that contains Python code can be imported as a module. For
example, suppose you have a file named <span><code class="docutils literal notranslate"><span class="pre">wc.py</span></code></span> with the
following code:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>def linecount(filename):
    count = 0
    for line in open(filename):
        count += 1
    return count

print(linecount(&#39;wc.py&#39;))
</pre></div>
</div>
<p>If you run this program, it reads itself and prints the number of lines
in the file, which is 7. You can also import it like this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; import wc
7
</pre></div>
</div>
<p>Now you have a module object <span><code class="docutils literal notranslate"><span class="pre">wc</span></code></span>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; wc
&lt;module &#39;wc&#39; from &#39;wc.py&#39;&gt;
</pre></div>
</div>
<p>The module object provides <code class="docutils literal notranslate"><span class="pre">linecount</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; wc.linecount(&#39;wc.py&#39;)
7
</pre></div>
</div>
<p>So that’s how you write modules in Python.</p>
<p>The only problem with this example is that when you import the module it
runs the test code at the bottom. Normally when you import a module, it
defines new functions but it doesn’t run them.</p>
<p>Programs that will be imported as modules often use the following idiom:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>if __name__ == &#39;__main__&#39;:
    print(linecount(&#39;wc.py&#39;))
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">__name__</span></code> is a built-in variable that is set when the program starts.
If the program is running as a script, <code class="docutils literal notranslate"><span class="pre">__name__</span></code> has the value
<code class="docutils literal notranslate"><span class="pre">'__main__'</span></code>; in that case, the test code runs. Otherwise, if the module
is being imported, the test code is skipped.</p>
<p>As an exercise, type this example into a file named <span><code class="docutils literal notranslate"><span class="pre">wc.py</span></code></span>
and run it as a script. Then run the Python interpreter and
<span><code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">wc</span></code></span>. What is the value of <code class="docutils literal notranslate"><span class="pre">__name__</span></code> when the
module is being imported?</p>
<p>Warning: If you import a module that has already been imported, Python
does nothing. It does not re-read the file, even if it has changed.</p>
<p>If you want to reload a module, you can use the built-in function
<span><code class="docutils literal notranslate"><span class="pre">reload</span></code></span>, but it can be tricky, so the safest thing to do
is restart the interpreter and then import the module again.</p>
</div>
<div class="section" id="debugging">
<h2>Debugging<a class="headerlink" href="#debugging" title="Permalink to this headline">¶</a></h2>
<p>When you are reading and writing files, you might run into problems with
whitespace. These errors can be hard to debug because spaces, tabs and
newlines are normally invisible:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; s = &#39;1 2\t 3\n 4&#39;
&gt;&gt;&gt; print(s)
1 2  3
 4
</pre></div>
</div>
<p>The built-in function <span><code class="docutils literal notranslate"><span class="pre">repr</span></code></span> can help. It takes any object
as an argument and returns a string representation of the object. For
strings, it represents whitespace characters with backslash sequences:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; print(repr(s))
&#39;1 2\t 3\n 4&#39;
</pre></div>
</div>
<p>This can be helpful for debugging.</p>
<p>One other problem you might run into is that different systems use
different characters to indicate the end of a line. Some systems use a
newline, represented <code class="docutils literal notranslate"><span class="pre">\n</span></code>. Others use a return character, represented
<code class="docutils literal notranslate"><span class="pre">\r</span></code>. Some use both. If you move files between different systems, these
inconsistencies can cause problems.</p>
<p>For most systems, there are applications to convert from one format to
another. You can find them (and read more about this issue) at
<a class="reference external" href="http://en.wikipedia.org/wiki/Newline">http://en.wikipedia.org/wiki/Newline</a>. Or, of course, you could write
one yourself.</p>
</div>
<div class="section" id="glossary">
<h2>Glossary<a class="headerlink" href="#glossary" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>persistent:<br />
Pertaining to a program that runs indefinitely and keeps at least
some of its data in permanent storage.</p></li>
<li><p>format operator:<br />
An operator, <span><code class="docutils literal notranslate"><span class="pre">%</span></code></span>, that takes a format string and a
tuple and generates a string that includes the elements of the tuple
formatted as specified by the format string.</p></li>
<li><p>format string:<br />
A string, used with the format operator, that contains format
sequences.</p></li>
<li><p>format sequence:<br />
A sequence of characters in a format string, like <span><code class="docutils literal notranslate"><span class="pre">%d</span></code></span>,
that specifies how a value should be formatted.</p></li>
<li><p>text file:<br />
A sequence of characters stored in permanent storage like a hard
drive.</p></li>
<li><p>directory:<br />
A named collection of files, also called a folder.</p></li>
<li><p>path:<br />
A string that identifies a file.</p></li>
<li><p>relative path:<br />
A path that starts from the current directory.</p></li>
<li><p>absolute path:<br />
A path that starts from the topmost directory in the file system.</p></li>
<li><p>catch:<br />
To prevent an exception from terminating a program using the
<span><code class="docutils literal notranslate"><span class="pre">try</span></code></span> and <span><code class="docutils literal notranslate"><span class="pre">except</span></code></span> statements.</p></li>
<li><p>database:<br />
A file whose contents are organized like a dictionary with keys that
correspond to values.</p></li>
<li><p>bytes object:<br />
An object similar to a string.</p></li>
<li><p>shell:<br />
A program that allows users to type commands and then executes them
by starting other programs.</p></li>
<li><p>pipe object:<br />
An object that represents a running program, allowing a Python
program to run commands and read the results.</p></li>
</ul>
</div>
<div class="section" id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Permalink to this headline">¶</a></h2>
<p>Write a function called <span><code class="docutils literal notranslate"><span class="pre">sed</span></code></span> that takes as arguments a
pattern string, a replacement string, and two filenames; it should read
the first file and write the contents into the second file (creating it
if necessary). If the pattern string appears anywhere in the file, it
should be replaced with the replacement string.</p>
<p>If an error occurs while opening, reading, writing or closing files,
your program should catch the exception, print an error message, and
exit. Solution: <a class="reference external" href="http://thinkpython2.com/code/sed.py">http://thinkpython2.com/code/sed.py</a>.</p>
<p>If you download my solution to Exercise <a class="reference external" href="#anagrams">[anagrams]</a> from
<a class="reference external" href="http://thinkpython2.com/code/anagram_sets.py">http://thinkpython2.com/code/anagram_sets.py</a>, you’ll see that it
creates a dictionary that maps from a sorted string of letters to the
list of words that can be spelled with those letters. For example,
<code class="docutils literal notranslate"><span class="pre">'opst'</span></code> maps to the list <code class="docutils literal notranslate"><span class="pre">['opts',</span> <span class="pre">'post',</span> <span class="pre">'pots',</span> <span class="pre">'spot',</span> <span class="pre">'stop',</span> <span class="pre">'tops']</span></code>.</p>
<p>Write a module that imports <code class="docutils literal notranslate"><span class="pre">anagram_sets</span></code> and provides two new
functions: <code class="docutils literal notranslate"><span class="pre">store_anagrams</span></code> should store the anagram dictionary in a
“shelf”; <code class="docutils literal notranslate"><span class="pre">read_anagrams</span></code> should look up a word and return a list of
its anagrams. Solution: <a class="reference external" href="http://thinkpython2.com/code/anagram_db.py">http://thinkpython2.com/code/anagram_db.py</a>.</p>
<p><span id="checksum" label="checksum">[checksum]</span></p>
<p>In a large collection of MP3 files, there may be more than one copy of
the same song, stored in different directories or with different file
names. The goal of this exercise is to search for duplicates.</p>
<ol class="simple">
<li><p>Write a program that searches a directory and all of its
subdirectories, recursively, and returns a list of complete paths
for all files with a given suffix (like <span><code class="docutils literal notranslate"><span class="pre">.mp3</span></code></span>). Hint:
<span><code class="docutils literal notranslate"><span class="pre">os.path</span></code></span> provides several useful functions for
manipulating file and path names.</p></li>
<li><p>To recognize duplicates, you can use <span><code class="docutils literal notranslate"><span class="pre">md5sum</span></code></span> to
compute a “checksum” for each files. If two files have the same
checksum, they probably have the same contents.</p></li>
<li><p>To double-check, you can use the Unix command <span><code class="docutils literal notranslate"><span class="pre">diff</span></code></span>.</p></li>
</ol>
<p>Solution: <a class="reference external" href="http://thinkpython2.com/code/find_duplicates.py">http://thinkpython2.com/code/find_duplicates.py</a>.</p>
</div>
</div>


              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="case_study_data_structures.html" title="previous page">Case study: data structure selection</a>
    <a class='right-next' id="next-link" href="classes_I.html" title="next page">Classes and objects</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Allan Downey<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="_static/js/index.js"></script>
    
  </body>
</html>